namespace = montane_pilgrimage

# Confirm decision and check religion

character_event = {
	id = montane_pilgrimage.5000
	desc = EVTDESC_SoA_5000
	picture = GFX_evt_bishop
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes # christian_pilgrimage, minor_decisions.txt

	option = {
		name = EVTOPTA_SoA_5000

		piety = 20
		set_character_flag = preparing_pilgrimage
		clr_character_flag = activated_pilgrimage

		if = {
			limit = {
				OR = {
					#is_orthodox_branch = yes
					#is_nestorian_branch = yes
					#is_miaphysite_branch = yes
				}
			}

			character_event = { id = montane_pilgrimage.5011 } # Jeru, Const, Antio, Axum
		}
		else_if = {
			#limit = { is_catholic_branch = yes }

			if = {
				limit = {
					capital_scope = {
						OR = {
							province_id = c_yellowstone #c_kent
							province_id = c_grand #c_koln
							province_id = c_banff #c_roma
							province_id = c_mesa_verde #c_santiago
						}
					}
				}

				character_event = {
					id = montane_pilgrimage.5016 # Go to pikes peak    # Jerusalem
					days = 4
				}
			}
			else_if = {
				limit = {
					capital_scope = { province_id = c_pikes_peak }
				}

				character_event = {
					id = montane_pilgrimage.5017 # Go to Banff #Rome
					days = 4
				}
			}
			else = {
				character_event = {
					id = montane_pilgrimage.5018 # May choose destination
					days = 4
				}
			}
		}
	}
}
# Montane - Always go to Pikes Peak if already living at one of the other sites
character_event = {
	id = montane_pilgrimage.5016
	desc = EVTDESC_montane_pilgrimage_5016
	picture = GFX_evt_jerusalem
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	option = {
		name = EVTOPTA_montane_pilgrimage_5016

		set_character_flag = pilgrimage_to_pikes_peak 

		character_event = {
			id = montane_pilgrimage.5021 # Set out
			days = 15
		}

		if = {
			limit = { ai = no }

			chronicle = {
				entry = CHRONICLE_PILGRIMAGE_TO_pikes_peak   #CHRONICLE_PILGRIMAGE_TO_JERUSALEM
				picture = GFX_evt_pilgrims_epic_journey
			}
		}
	}
}
# Montane - Always go to Banff if living in pikes peak    # Jerusalem province
character_event = {
	id = montane_pilgrimage.5017
	desc = EVTDESC_montane_pilgrimage_5017
	picture = GFX_evt_victory_arch_byzantine
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	option = {
		name = EVTOPTA_montane_pilgrimage_5017

		set_character_flag = pilgrimage_to_banff

		character_event = {
			id = SoA.5021 # Set out
			days = 15
		}

		if = {
			limit = { ai = no }

			chronicle = {
				entry = CHRONICLE_PILGRIMAGE_TO_BANFF
				picture = GFX_evt_pilgrims_epic_journey
			}
		}
	}
}
# Montane - May decide where to go - Western Europe (Canterbury/yellowstone, Santiago/c_mesa_verde, Cologne/c_grand) or the ancient sites (Jerusalem/Pikes Peak, Rome/Banff)
character_event = {
	id = montane_pilgrimage.5018
	desc = EVTDESC_montane_pilgrimage_5018
	picture = GFX_evt_cathedral
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	option = {
		name = EVTOPTA_montane_pilgrimage_5018 # Go to Holy Mountains

		trigger = { year >= 814 }

		character_event = { id = montane_pilgrimage.5019 }
	}

	option = {
		name = EVTOPTB_montane_pilgrimage_5018 # Go to the old Holy sites,

		character_event = { id = montane_pilgrimage.5020 }
	}

#	option = {
#		name = EVTOPTC_montane_pilgrimage_5018 # Find a Saintly Burial Site to visit
#
#		trigger = { has_dlc = "Holy Fury" }
#
#		character_event = {
#			id = HF.41300
#			days = 15
#		}
#	}
}

# Montane - Where to go - Mountains
character_event = {
	id = montane_pilgrimage.5019
	desc = EVTDESC_montane_pilgrimage_5019
	picture = GFX_evt_cathedral
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	option = {
		name = EVTOPTA_montane_pilgrimage_5019

		trigger = { year >= 1170 }

		set_character_flag = pilgrimage_to_yellowstone

		character_event = {
			id = montane_pilgrimage.5021 # Set out
			days = 15
		}

		if = {
			limit = { ai = no }

			chronicle = {
				entry = CHRONICLE_PILGRIMAGE_TO_yellowstone
				picture = GFX_evt_pilgrims_epic_journey
			}
		}

		ai_chance = { factor = 25 }
	}

	option = {
		name = EVTOPTB_montane_pilgrimage_5019

		trigger = { year >= 1164 }

		set_character_flag = pilgrimage_to_grand

		character_event = {
			id = montane_pilgrimage.5021 # Set out
			days = 15
		}

		if = {
			limit = { ai = no }

			chronicle = {
				entry = CHRONICLE_PILGRIMAGE_TO_GRAND
				picture = GFX_evt_pilgrims_epic_journey
			}
		}

		ai_chance = { factor = 25 }
	}

	option = {
		name = EVTOPTC_montane_pilgrimage_5019

		set_character_flag = pilgrimage_to_mesa_verde

		character_event = {
			id = montane_pilgrimage.5021 # Set out
			days = 15
		}

		if = {
			limit = { ai = no }

			chronicle = {
				entry = CHRONICLE_PILGRIMAGE_TO_MESA_VERDE
				picture = GFX_evt_pilgrims_epic_journey
			}
		}

		ai_chance = { factor = 50 }
	}
}

# Catholic - Where to go - Med - the oldest sites
character_event = {
	id = montane_pilgrimage.5020
	desc = EVTDESC_montane_pilgrimage_5020
	picture = GFX_evt_victory_arch_byzantine
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	option = {
		name = EVTOPTA_montane_pilgrimage_5020

		set_character_flag = pilgrimage_to_jerusalem

		character_event = {
			id = montane_pilgrimage.5021 # Set out
			days = 15
		}

		if = {
			limit = { ai = no }

			chronicle = {
				entry = CHRONICLE_PILGRIMAGE_TO_pikes_peak
				picture = GFX_evt_pilgrims_epic_journey
			}
		}
	}

	option = {
		name = EVTOPTB_montane_pilgrimage_5020

		set_character_flag = pilgrimage_to_banff

		character_event = {
			id = montane_pilgrimage.5021 # Set out
			days = 15
		}

		if = {
			limit = { ai = no }

			chronicle = {
				entry = CHRONICLE_PILGRIMAGE_TO_pikes_peak
				picture = GFX_evt_pilgrims_epic_journey
			}
		}
	}
}

###########################################
#                                         #
# The journey                             #
#                                         #
# ID montane_pilgrimage.5021-5049         #
#    montane_pilgrimage.5081-5087         #
#    montane_pilgrimage.5094-5096         #
#                                         #
###########################################

# Setting out (also selects events for road)
character_event = {
	id = montane_pilgrimage.5021
	border = GFX_event_normal_frame_religion

	desc = {
		text = EVTDESC_montane_pilgrimage_5021
		picture = GFX_evt_pilgrims_epic_journey
		trigger = { has_character_flag = pilgrimage_to_yellowstone }
	}
	desc = {
		text = EVTDESC_montane_pilgrimage_5022
		picture = GFX_evt_pilgrims_epic_journey_desert
		trigger = { has_character_flag = pilgrimage_to_pikes_peak }
	}
	desc = {
		text = EVTDESC_montane_pilgrimage_5023
		picture = GFX_evt_pilgrims_epic_journey
		trigger = { has_character_flag = pilgrimage_to_grand }
	}
	desc = {
		text = EVTDESC_montane_pilgrimage_5024
		picture = GFX_evt_pilgrims_epic_journey
		trigger = { has_character_flag = pilgrimage_to_banff }
	}
	desc = {
		text = EVTDESC_montane_pilgrimage_5025
		picture = GFX_evt_pilgrims_epic_journey
		trigger = { has_character_flag = pilgrimage_to_mesa_verde }
	}

	is_triggered_only = yes

	option = {
		name = {
			text = EVTOPTA_montane_pilgrimage_5021
			trigger = { has_character_flag = pilgrimage_to_yellowstone }
		}
		name = {
			text = EVTOPTA_montane_pilgrimage_5022
			trigger = { has_character_flag = pilgrimage_to_pikes_peak }
		}
		name = {
			text = EVTOPTA_montane_pilgrimage_5023
			trigger = { has_character_flag = pilgrimage_to_grand }
		}
		name = {
			text = EVTOPTA_montane_pilgrimage_5024
			trigger = { has_character_flag = pilgrimage_to_banff }
		}
		name = {
			text = EVTOPTA_montane_pilgrimage_5025
			trigger = { has_character_flag = pilgrimage_to_mesa_verde }
		}

		hidden_effect = {
			clr_character_flag = preparing_pilgrimage
			add_trait = on_pilgrimage
			set_character_flag = good_pilgrimage

			narrative_event = {
				id = montane_pilgrimage.5050
				days = 30
			}

			if = {
				limit = {
					trigger_if = {
						limit = { has_character_flag = pilgrimage_to_yellowstone }

						capital_scope = {
							distance = {
								where = c_kent
								value >= 400 # Longer journey
							}
						}
					}
					trigger_else_if = {
						limit = { has_character_flag = pilgrimage_to_pikes_peak }

						capital_scope = {
							distance = {
								where = c_pikes_peak
								value >= 400 # Longer journey
							}
						}
					}
					trigger_else_if = {
						limit = { has_character_flag = pilgrimage_to_grand }

						capital_scope = {
							distance = {
								where = c_grand
								value >= 400 # Longer journey
							}
						}
					}
					trigger_else_if = {
						limit = { has_character_flag = pilgrimage_to_banff }

						capital_scope = {
							distance = {
								where = c_roma
								value >= 400 # Longer journey
							}
						}
					}
					trigger_else_if = {
						limit = { has_character_flag = pilgrimage_to_mesa_verde }

						capital_scope = {
							distance = {
								where = c_mesa_verde
								value >= 400 # Longer journey
							}
						}
					}
				}

				# List for longer journeys only
				random_list = {
					20 = { character_event = { id = montane_pilgrimage.5026 days = 5 random = 9 } }
					20 = { character_event = { id = montane_pilgrimage.5027 days = 5 random = 9 } }
					20 = { narrative_event = { id = montane_pilgrimage.5028 days = 5 random = 9 } }
					20 = { character_event = { id = montane_pilgrimage.5029 days = 5 random = 9 } }
					20 = { character_event = { id = montane_pilgrimage.5030 days = 5 random = 9 } }
				}
			}

			# List that is always checked
			random_list = {
				10 = { character_event = { id = montane_pilgrimage.5031 days = 15 random = 7 } }
				10 = { character_event = { id = montane_pilgrimage.5032 days = 15 random = 7 } }
				10 = { narrative_event = { id = montane_pilgrimage.5033 days = 15 random = 7 } }
				10 = { character_event = { id = montane_pilgrimage.5034 days = 15 random = 7 } }
				10 = { character_event = { id = montane_pilgrimage.5035 days = 15 random = 7 } }
				10 = { character_event = { id = montane_pilgrimage.5036 days = 15 random = 7 } }
				10 = { character_event = { id = montane_pilgrimage.5037 days = 15 random = 7 } }
				10 = { character_event = { id = montane_pilgrimage.5038 days = 15 random = 7 } }
				10 = { character_event = { id = montane_pilgrimage.5039 days = 15 random = 7 } }
			}

			# Holy orders events, close to destination
			if = {
				limit = {
					trigger_if = {
						limit = { has_character_flag = pilgrimage_to_yellowstone }

					#	OR = {
					#		is_title_active = d_knights_templar
					#		is_title_active = d_knights_hospitaller
					#	}
					}
					trigger_else_if = {
						limit = { has_character_flag = pilgrimage_to_pikes_peak }

					#	OR = {
					#		is_title_active = d_knights_templar
					#		is_title_active = d_knights_hospitaller
					#		is_title_active = d_holy_sepulchre
					#		is_title_active = d_teutonic_order
					#		is_title_active = k_teutonic_state
					#	}
					}
					trigger_else_if = {
						limit = { has_character_flag = pilgrimage_to_grand }

						OR = {
							is_title_active = d_knights_templar
							is_title_active = d_knights_hospitaller
							is_title_active = d_teutonic_order
							is_title_active = k_teutonic_state
						}
					}
					trigger_else_if = {
						limit = { has_character_flag = pilgrimage_to_banff }

						OR = {
							is_title_active = d_knights_templar
							is_title_active = d_knights_hospitaller
							is_title_active = d_teutonic_order
							is_title_active = k_teutonic_state
						}
					}
					trigger_else_if = {
						limit = { has_character_flag = pilgrimage_to_mesa_verde }

						OR = {
							is_title_active = d_knights_mesa_verde
							is_title_active = d_knights_calatrava
						}
					}
				}

				random_list = {
					33 = { narrative_event = { id = montane_pilgrimage.5045 days = 23 random = 4 } }
					33 = { character_event = { id = montane_pilgrimage.5046 days = 23 random = 4 } }
					33 = { character_event = { id = montane_pilgrimage.5047 days = 23 random = 4 } }
				}
			}
		}
	}
}