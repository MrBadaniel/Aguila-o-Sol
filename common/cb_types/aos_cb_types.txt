# Forester CB by Ekans
cb_liberate_wilds = {
	name = CB_NAME_LIBERATE_WILDS
	war_name = WAR_NAME_LIBERATE_WILDS
	sprite = 8
	truce_days = 3650
	is_permanent = yes
	check_de_jure_tier = DUKE # this scans all dejure duchies for the counties which are held by or vassals(or below) # of selected character. Only valid if is_permanent = yes

	allowed_to_target_tributaries = no

	infamy_modifier = 0.75
	
	sort_priority = 810
	
	can_use_gui = {
		ROOT = {
			NOT = { has_character_modifier = liberate_wilds_cooldown }
			prestige = 100
		}
	}

	can_use = {
		FROM = {
			NOR = { 
			religion = gaian
			religion = forester
			religion = edenite
			}
		}
		ROOT = {
			NOT = { same_realm = FROM }
			mercenary = no
			government = reserve_government	
		}
	}
	
	can_use_title = {
		# The attacker needs at least one county in the target kingdom, or a border, or be only two sea zones away #from one of your counties m'kay
		any_direct_de_jure_vassal_title = {
			OR = {
				holder_scope = {
					OR = {
						character = ROOT
						is_liege_or_above = ROOT
					}
				}
				location = {
					any_neighbor_province = {
						has_owner = yes
						owner = {
							OR = {
								character = ROOT
								is_liege_or_above = ROOT
							}
						}
					}
				}
			}
		}
		
		#any_de_jure_vassal_title = { # Can only liberate Duchies that are either outside of the Steppe region, or #contains a Castle/City/Tribe
		#	tier = COUNT
		#	OR = {
		#		holder_scope = {
		#			character = FROM
		#		}
		#		holder_scope = {
		#			any_liege = {
		#				character = FROM
		#			}
		#		}
		#	}
		#	OR = {
		#		location = {
		#			NOT = {
		#				region = world_steppe
		#			}
		#		}
		#		location = {
		#			any_province_holding = {
		#				OR = {
		#					holding_type = city
		#					holding_type = castle
		#					holding_type = tribal
		#				}
		#			}
		#		}
		#	}
		#}
	}

	is_valid = {
		FROM = {
			NOR = { 
			religion = gaian
			religion = forester
			religion = edenite
			}
		}
		ROOT = {
			NOT = { same_realm = FROM }
			mercenary = no
			government = reserve_government	
		}
	}

	
	on_add = {
		ROOT = { 
				custom_tooltip = {
					text = holy_war_cooldown_ctt
					hidden_tooltip = {
						add_character_modifier = {
							name = liberate_wilds_cooldown
							duration = 1825
						}
					}
				}
			
			prestige = -100 
		}
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
		if = {
			limit = { defender = { is_offmap_governor = offmap_china } }
			attacker = { 
				sound_effect = china_angered_emperor
				detract_grace_super_huge_effect = yes 
			}
		}
	}	
	
	on_success = {
		ROOT = {
			show_scope_change = no
			participation_scaled_prestige = 200
			if = {
				limit = {
					uses_decadence = yes
				}
				participation_scaled_decadence = -10
			}
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { 
				participation_scaled_prestige = 200
				if = {
					limit = {
						uses_decadence = yes
					}
					participation_scaled_decadence = -10
				}
			}
		}
		
		FROM = { show_scope_change = no prestige = -200 }
	}

	on_success_title = {
		check_holy_order_donation_effect = yes

		custom_tooltip = {
			text = liberate_nomad_cb_succ_tip
			hidden_tooltip = {
				ROOT = {
					vassalize_or_take_under_title = {
						title = PREV
						enemy = FROM
						type = invasion
					}
				}
			}
		}
	}

	on_fail = {
		ROOT = {
			show_scope_change = no
			prestige = -200
		}
	}

	on_reverse_demand = {
		ROOT = {
			show_scope_change = no
			transfer_scaled_wealth = {
				to = FROM
				value = 4.0
			}
			prestige = -200
		}
		FROM = {
			participation_scaled_prestige = 300
			if = {
				limit = {
					uses_decadence = yes
				}
				participation_scaled_decadence = -10
			}
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { 
				participation_scaled_prestige = 300
				if = {
					limit = {
						uses_decadence = yes
					}
					participation_scaled_decadence = -10
				}
			}
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 100
	}
	
	ai_will_do = {
		factor = 1
			modifier = { factor = 3	trait = zealous }
			modifier = { factor = 3	trait = devout }
			modifier = { factor = 2	trait = brave }
			modifier = { factor = 2	trait = ambitious }
			modifier = { factor = 0 trait = craven }
			modifier = { factor = 0 trait = content }
	}
}